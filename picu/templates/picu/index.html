<!-- index page shows a searchable form and a link to anter a new admission via a number of routes-->
{% extends "admin/change_list.html" %}
{% load i18n admin_urls static admin_list admin_modify %}
{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="/static/picu/css/vendor/datatables/datatables.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/base.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/widgets.css"/>
{% endblock %}
{% block extrahead %}

    <script type="text/javascript" src="/admin/jsi18n/"></script>
    <script type="text/javascript" src="/static/admin/js/core.js"></script>
    <!--<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>-->
    <script type="text/javascript" src="/static/admin/js/vendor/jquery/jquery.js"></script>
    <script type="text/javascript" src="/static/picu/js/vendor/datatables/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/static/picu/js/vendor/datatables/datatables.min.js"></script>
    <script type="text/javascript" src="/static/admin/js/jquery.init.js"></script>

    <script type="text/javascript" src="/static/admin/js/admin/RelatedObjectLookups.js"></script>
    <script type="text/javascript" src="/static/admin/js/actions.js"></script>
    <script type="text/javascript" src="/static/admin/js/urlify.js"></script>
    <script type="text/javascript" src="/static/admin/js/prepopulate.js"></script>
    <script type="text/javascript" src="/static/admin/js/vendor/xregexp/xregexp.js"></script>
    <script type="text/javascript" src="/static/admin/js/calendar.js"></script>
    <script type="text/javascript" src="/static/admin/js/admin/DateTimeShortcuts.js"></script>
    <script type="text/javascript" src="/static/admin/js/collapse.js"></script>



	<script type="text/javascript">
        django.jQuery(document).ready(function($) {
            $('#patient-search-results').DataTable();
        });

	</script>

{% endblock %}
{% block bodyclass %}{{ block.super }} app-picu change-list {% endblock %}

{% block breadcrumbs %} <div class="breadcrumbs">&nbsp;Home</div> {% endblock %}

{% block content %}
	<div id="content-main">
		{% block object-tools %}
            <ul class="object-tools">
                <li>
                  <a href="{% url 'admin:picu_admission_add' %}" class="addlink">New Admission</a>
                </li>
            </ul>
        {% endblock %}
        <div id="searchform" class="module filtered">
            <div class="actions">
                <form id="search-patient-form" action="{% url 'picu:patient_search' %}" method="post">
                    <div>
                        {% csrf_token %}
                        <table>
                            {{form}}
                        </table>
                         <input type="submit" value="Search">
                    </div>
                </form>
            </div>

            <div class="clear"><br/><hr/></div>

            {% if patient_list %}

            <div id="changelist" class="results">
                <table id="patient-search-results">
                    <caption>
                        <a href="#" class="section" title="patients">Patients matched</a>
                    </caption>
                    <thead>
                        <tr>
                            <th scope="col" class="action-checkbox-column">
                               <div class="text">
                                   <span>
                                       <input id="action-toggle" type="checkbox">
                                   </span>
                               </div>
                               <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-first_name">
                               <div class="text">First name</div>
                               <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-second_name">
                               <div class="text">Second name</div>
                               <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-gender">
                               <div class="text">Gender</div>
                               <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-date_of_birth">
                               <div class="text">Date of Birth</div>
                               <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-hiv">
                               <div class="text">Hiv</div>
                               <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-age_in_months">
                               <div class="text">Age in Months</div>
                               <div class="clear"></div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for patient in patient_list %}
                            <tr class="{% cycle 'row1' 'row2' %}">
                                <td class="action-checkbox">
                                    <input class="action-select" name="_selected_action" value="1" type="checkbox">
                                </td>
                                <th class="field-first_name">
                                    <!-- link to view the patient details + all admissions-->
                                    <a href="{% url 'picu:patient_view' patient.id  %}">{{ patient.first_name }}</a>
                                </th>
                                <td class="field-second_name">{{ patient.second_name }}</td>
                                <td class="field-gender">{{ patient.gender }}</td>
                                <td class="field-date_of_birth nowrap">{{ patient.date_of_birth }}</td>
                                <td class="field-hiv">
                                    <img src="/static/admin/img/icon-{% if patient.hiv %}yes.svg {% else %}no.svg {% endif %}" alt="True">
                                </td>
                                <td class="field-age_in_months">{{ patient.age_in_months }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p>
                {% trans "No patients available" %}
            </p>
        {% endif %}
        </div>
    </div>
{% endblock %}